# Process Synchronization

## 🍎 프로세스 간 통신
- 프로세스는 자신의 독립적인 메모리 공간을 가지고 보호하기 때문에 별도의 매커니즘이 필요하다.
- 프로세스는 독립적으로 실행되기도 하지만 다른 프로세스와 데이터를 주고 받으며 통신 하는 경우도 있다.
- 통신은..
    - 한 컴퓨터 내에서 다른 프로세스와 할 수도 있고, 네트워크로 연결된 다른 프로세스와도 할 수 있다.
- 프로세스 간 통신의 종류
    - 한 컴퓨터 내에서 통신하는 방법
        - 파일을 이용한 방법
            - 통신을 하려는 프로세스들이 하나의 파일을 이용해 읽고 쓰는 방법
        - 파이프를 이용한 방법
            - 운영체제가 생성한 파이프를 이용해 데이터를 읽고 쓰는 방법
    - 네트워크를 이용한 방법
        - 운영체제가 제공하는 소켓 통신이나 다른 컴퓨터에 있는 함수를 호출하는 RPC(원격 프로시저 호출)를 이용해 통신하는 방법이 있습니다.

## 🍎 쓰레드 간 통신
- 하나의 프로세스 내에서 쓰레드는 코드, 데이터, 힙 영역을 공유하고 스택만 각자 자기의 것을 가지고 있다. 여기서 데이터 영역에 있는 전역변수나 힙을 이용하면 통신이 가능하다.

## 🍎 공유자원과 임계구역
- 프로세스 간 통신을 할 때 공동으로 이용하는 변수나 파일들이 있는데 이런 것들을 공유자원이라 한다.
- 공유 자원은 여러 프로세스가 공유하고 있기 때문에 각 프로세스의 접근 순서에 따라 결과가 달라질 수 있다.
- 여러 프로세스가 동시에 접근하면 안되는 구역을 **임계 구역 (Critical Section)**이라 한다.
- 공유 자원을 서로 사용하기 위해 경쟁하는 것은 **경쟁조건 (Race Condition)**이라 한다.

## 🍎 프로세스가 동시에 임계 구역에 접근하는 문제 해결하기
- 임계 구역에 여러 프로세스가 동시에 접근하는것을 막기 위해서는 **상호 배제(Mutual Exclusion) 매커니즘이 필요**하다.
- 상호 배제의 요구사항
    - 1. 임계구역에는 동시에 하나의 프로세스만 접근한다.
    - 2. 여러 요청에도 하나의 프로세스의 접근만 허용한다.
    - 3. 임계구역에 들어간 프로세스는 빠르게 나와야 한다.

## 🍎 상호배제 알고리즘
- 프로세스가 임계 구역에 들어가 공유자원을 사용할 때 예상치 못한 일을 막는 방법으로는 크게 두가지가 있다.
- 세마포어
    - 임계 구역에 들어갈 수 있는 수를 정해놓는다 <- 세마포어는 실제로 정수형 변수다.
        - 공유자원이 2개라면 세마포어 값은 2
        ```java
        int s = 1;
        
        wait(s); // 세마포어(s)의 수를 하나 줄이고, 문을 잠근다. 
        int currentHealth = GetHealth();
        health = currentHealth + 50;
        
        signal(s); // 문을 열고 세모포어(s)의 수를 하나 늘린다.
        ``` 
    - 프로세스가 wait(s);를 만나면 세마포어(s)의 수를 하나 줄이고 임계구역에 접근한다. (문을 잠근다)
    - 프로세스가 signal(s); 세마포어(s)의 수를 하나 올리고 임계 구역을 빠져나온다. (잠궜던 문을 해제한다)
    - wait() 함수와 signal() 함수의 순서를 이상하게 호출하면 의도치 않은 결과를 가져올 수 있다.
- 모니터
    - 세마포어의 단점을 해결한 상호배제 매커니즘
    - 모니터는 운영체제가 따로 처리하는 것이 아니라 프로그래밍 언어차원에서 지원하는 방법 (JAVA, .NET, C#)
        - 대표적으로 JAVA에서 모니터를 지원하는데 예시 코드를 보면서 이해해보자
        ```java
        public class Health {
            private int health = 100;
            
            synchronized void increase(int amount) {
                health += amount;
            }
            
            synchronized void decrease(int amount) {
                health -= amount;
            }
        }
        ```
        - 자바에서 synchronized 키워드가 붙으면, 이 키워드가 붙은 함수들은 동시에 여러 프로세스(자바에선 쓰레드)에서 실행 시킬 수 없다.
        - 만약 프로세스 A에서 increase() 함수를 호출하면, 프로세스 B에서는 increase() 함수 뿐만 아니라 synchronized 키워드가 붙은 decrease() 함수 또한 사용 할 수 없다.
        - 즉, synchronized가 적용된 메서드끼리 일괄적으로 lock을 공유해 어떤 인스턴스가 해당 메서드를 사용하고 있으면 다른 인스턴스는 아무 메서드도 사용 할 수 없도록 만들어 놓은것이다.
        - 개발자는 세마포어처럼 wait() 함수나 signal() 함수를 임계 구역에 감싸지 않아도 돼서 편리하고 안전하게 코드를 작성할 수 있다.
        - 하지만 synchronized 키워드를 너무 남발해서 사용하게 되면 필요하지 않은곳에서도 메서드에 lock이 걸려 성능이 저하될 수 있다.
